# 🪙 JWT
Json Web Token, 줄여서 JWT라고 한다.


### 🤔 JWT 토큰이 뭐임?
'세션 인증 방식'을 대체할 수 있는 수단이 '토큰 기반 인증'이고, 그 중에서도 가장 많이 사용되는 토큰이 JWT이 유명함.

* 세션 인증 방식
    * 서버 or DB에 사용자를 특정할 수 있는 세션 ID를 생성해서 저장
    * 클라이언트의 cookie에 세션정보를 저장. 
    * 리액트앱이라면 cookie 뿐만 아니라State, Local Storage에도 저장가능
    * 매 요청시 session을 cookie에 담아 헤더에 실어서 보내면 서버는 사용자를 인증.
    - 단점
        - 매 요청마다 DB에 접근해야함.
        - DB에서 session 정보를 계속 저장하는 것도 아니라 DB에 부담이 됨.
        - cookie정보들은 클라이언테 저장되어 JS로 접근이 가능하기 때문에 XSS공격에 취약함.
* 토큰 인증 방식
    * 사용자 정보를 암호화하여 토큰을 클라이언트에 저장해서 사용기때문에 안전하게 관리
    * 서버가 사용자 정보를 저장할 필요가 없으며 토큰이 정상적인 토큰인지만 확인하면 되어 불필요한 코스트를 낭비할 필요가 없다.
    * 여러 서버에서 검토가 가능하기 때문에, 서버마다 인증을 할 필요가 없다.
    * 토큰을 다른 기관에서 발급받을 수 있어서 토큰 생성만 하는 서버를 따로 생성하거나 다른 회사에 토큰 생성 작업을 맡길 수 있어서 토큰관리의 용이성이 높다.
    * JWT는 3부분으로 나뉜다
        * Header
            * JWT의 타입, 해시 알고리즘 지정.
            ```
            {
                "typ": "JWT (JWT의 타입)",
                "alg": "HS256 (해더의 해시알고리즘. 주로 HS256,RS256,EES256)"
            }
            ```
            
        * Payload
            * JWT의 실직적인 데이터를 담는다.
            * 사용자가 사용가능한 권한 카테고리를 담아 사용자별 권한을 관리하기 용이.
            ```
            {
                "sub": "토큰 소유자1",
                "name": "토큰 소유자1의 이름",
                "exp": 1643264000(토큰 만료시간),
                "iat": 1231123(토큰 발행시간),
                "aud": "토큰을 받을 대상",
                "iss": "토큰 발행한 발급자"
            }
            ```
        * Signature
            * Header와 Payload의 해시값을 사용하여 계산한 값
            * JWT의 유효성을 검사
            
            
### 🤔 종류도 있음?
* Access Token : 사용자 정보에 접근할 수 있는 권한을 부여하는데 사용
    * 클라이언트는 서버에 최초 요청을 보내면 해킹에 대비하기 위해 Aceess,RefreshToken 둘다 받게 되는데, 실제 권한은 AccessToken에 사용된다.
        - ❗️ 두개 받는거랑 권한이랑 뭔상관?
            1. 해커가 Access Token을 탈취하면 본인인척 서버에 권한을 부여받음. AccessToken은 유효기간이 원래 짧은 토큰이라 장기간 사용하지 못한다고 하는데, 솔직히 효과가 있는지 모르겠다.
* Refresh Token : 갱신에 사용.
    * AceessToken의 유효기간이 지나게 되면 Refresh Token을 사용해 새로운 AccessToken을 발급받는다.
    - ❗️ 단점
        - 해커는 지속적으로 Refresh Token을 사용해 AccessToken을 갱신하게 될 것이다.
        - RefreshToken을 사용하지 않는 웹사이트는 짧은 시간 AccessToken만으로 사용자 정보를 관리하여 정보 유출을 막는다.


### 🤝🏻 인증 절차는?
1. 사용자는 서버에 ID/Password 등 사용자 정보를 제공하고 로그인 요청.
2. 서버는 사용자 정보를 검증이후에 암호화된 토큰 생산.
3. 암호화된 토큰 생산시 토큰의 payload에는 사용자를 식별할 수있는 정보와 권한 등등이 저장됨. ( local storage, cookie, state등에 저장)
4. 이 후 요청부터는 사용자가 http헤더에 토큰을 담아 보낸다. 이때 토큰을 담는 속성은 authorization이다.
5. 서버는 헤더에 존재하는 토큰을 해독한 후, 정상일경우 사용자 요청을 처리애 응답.
